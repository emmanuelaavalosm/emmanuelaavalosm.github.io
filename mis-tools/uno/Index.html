import asyncio
import websockets
import pyautogui
import json

# Tamaño actual de la pantalla
screen_width, screen_height = pyautogui.size()

# Posición inicial del cursor
prev_x, prev_y = None, None

async def mouse_handler(websocket):
    global prev_x, prev_y
    async for message in websocket:
        try:
            data = json.loads(message)

            if data["type"] == "move":
                dx, dy = data["dx"], data["dy"]
                x, y = pyautogui.position()
                pyautogui.moveTo(x + dx, y + dy)

            elif data["type"] == "click":
                if data["button"] == "left":
                    pyautogui.click()
                elif data["button"] == "right":
                    pyautogui.click(button='right')
                elif data["button"] == "double":
                    pyautogui.doubleClick()

            elif data["type"] == "key":
                pyautogui.press(data["key"])

            elif data["type"] == "scroll":
                pyautogui.scroll(data["amount"])

        except Exception as e:
            print("Error:", e)

async def main():
    async with websockets.serve(mouse_handler, "0.0.0.0", 8765):
        print("Servidor WebSocket corriendo en ws://<TU_IP>:8765")
        await asyncio.Future()  # Ejecuta indefinidamente

asyncio.run(main())
